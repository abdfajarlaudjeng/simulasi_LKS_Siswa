<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistem Login Sekolah</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body {
  background: linear-gradient(135deg, #6366f1, #a855f7);
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
}
.card {
  background: white;
  border-radius: 1rem;
  box-shadow: 0 10px 20px rgba(0,0,0,0.2);
  padding: 2rem;
  width: 100%;
  max-width: 420px;
}
.hidden { display: none; }
</style>
</head>
<body>

<div class="card" id="loginSection">
  <h1 class="text-2xl font-bold text-center mb-6">Login Sistem Sekolah</h1>
  <form id="loginForm" class="space-y-4">
    <div>
      <label class="block font-medium">Email</label>
      <input type="email" id="email" required class="w-full p-2 border rounded">
    </div>
    <div>
      <label class="block font-medium">Password</label>
      <input type="password" id="password" required class="w-full p-2 border rounded">
    </div>
    <div>
      <label class="block font-medium">Role</label>
      <select id="role" class="w-full p-2 border rounded">
        <option value="guru">Guru</option>
        <option value="siswa">Siswa</option>
      </select>
    </div>
    <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white w-full py-2 rounded font-semibold">
      Login
    </button>
  </form>
  <p id="status" class="text-center text-sm text-red-600 mt-4"></p>
</div>

<!-- Dashboard -->
<div class="card hidden" id="dashboard">
  <h2 class="text-xl font-bold text-center mb-2">Selamat Datang üëã</h2>
  <p id="userInfo" class="text-center text-gray-700 mb-4"></p>
  <button id="logoutBtn" class="bg-red-500 hover:bg-red-600 text-white w-full py-2 rounded font-semibold">Logout</button>
</div>

<script>
// Ganti URL Web App Google Apps Script kamu di bawah ini üëá
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwXbjj3C2QOqCBeQDFLf9h5n4--ND9Bv11DS2CNSGc7pw5KY4XLuE7WEoQv_tKwm-DKIw/exec";

const form = document.getElementById('loginForm');
const statusEl = document.getElementById('status');
const loginSection = document.getElementById('loginSection');
const dashboard = document.getElementById('dashboard');
const userInfo = document.getElementById('userInfo');

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  statusEl.textContent = "Memeriksa data...";
  
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value.trim();
  const role = document.getElementById('role').value;
  
  try {
    const res = await fetch(`${SCRIPT_URL}?action=login&email=${encodeURIComponent(email)}&password=${encodeURIComponent(password)}&role=${role}`);
    const data = await res.json();

    if (data.success) {
      localStorage.setItem('user', JSON.stringify(data.user));
      showDashboard(data.user);
    } else {
      statusEl.textContent = "‚ùå " + data.message;
    }
  } catch (err) {
    statusEl.textContent = "‚ö†Ô∏è Gagal menghubungi server. Periksa koneksi Anda.";
  }
});

function showDashboard(user) {
  loginSection.classList.add('hidden');
  dashboard.classList.remove('hidden');
  userInfo.innerHTML = `
    <strong>Nama:</strong> ${user.Nama}<br>
    <strong>Role:</strong> ${user.Role}<br>
    <strong>Email:</strong> ${user.Email}
  `;
}

document.getElementById('logoutBtn').addEventListener('click', () => {
  localStorage.removeItem('user');
  dashboard.classList.add('hidden');
  loginSection.classList.remove('hidden');
});

window.onload = () => {
  const user = JSON.parse(localStorage.getItem('user'));
  if (user) showDashboard(user);
};
</script>

</body>
</html>
